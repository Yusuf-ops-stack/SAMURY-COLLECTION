<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SAMURY Admin Panel</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #ff4081;
      --secondary-color: #fff;
      --bg-color: #fdf5f7;
      --text-color: #333;
    }

    * { box-sizing: border-box; }
    body { font-family: 'Segoe UI', sans-serif; background: var(--bg-color); margin: 0; padding: 0 20px; color: var(--text-color); }
    h1 { text-align: center; margin: 20px 0; color: var(--primary-color); }

    /* Login */
    #loginDiv {
      max-width: 400px;
      margin: 50px auto;
      background: var(--secondary-color);
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    #loginDiv input, #loginDiv button {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border-radius: 10px;
      border: 1px solid #ccc;
      font-size: 16px;
    }

    #loginDiv button {
      background: var(--primary-color);
      color: #fff;
      border: none;
      cursor: pointer;
      transition: 0.3s;
    }

    #loginDiv button:hover { opacity: 0.9; }

    /* Admin Form */
    #adminDiv { max-width: 900px; margin: 30px auto; }
    form {
      background: var(--secondary-color);
      padding: 25px;
      border-radius: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      margin-bottom: 40px;
    }

    input, textarea, button {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border-radius: 10px;
      border: 1px solid #ccc;
      font-size: 16px;
    }

    button {
      background: var(--primary-color);
      color: #fff;
      border: none;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover { opacity: 0.9; }

    /* Products Grid */
    .products {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
    }

    .product-card {
      background: var(--secondary-color);
      border-radius: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      overflow: hidden;
      position: relative;
      transition: 0.3s;
    }

    .product-card:hover { transform: translateY(-5px); }

    .product-card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }

    .product-card h3 { margin: 10px; color: var(--primary-color); }
    .product-card p { margin: 5px 10px; font-size: 14px; color: #555; }
    .btn-group { display: flex; justify-content: space-between; padding: 10px; }
    .btn-group button { width: 48%; font-size: 14px; }
  </style>
</head>
<body>

<h1>SAMURY Admin Panel</h1>

<!-- Login -->
<div id="loginDiv">
  <input type="email" id="email" placeholder="Owner Email">
  <input type="password" id="password" placeholder="Password">
  <button id="loginBtn">Login</button>
</div>

<!-- Admin Panel -->
<div id="adminDiv" style="display:none;">
  <form id="productForm">
    <input type="text" id="name" placeholder="Product Name" required>
    <input type="number" id="price" placeholder="Price" required>
    <textarea id="description" placeholder="Description"></textarea>
    <input type="text" id="category" placeholder="Category (e.g., Female Collection)" required>
    <input type="file" id="image" required>
    <button type="submit">Add Product</button>
  </form>

  <h2>Your Products</h2>
  <div class="products" id="productsContainer"></div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
  import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCoI2NyN9tjwlJJKMVIYvLlpp0GKIjcJhE",
    authDomain: "samury-collections.firebaseapp.com",
    databaseURL: "https://samury-collections-default-rtdb.firebaseio.com",
    projectId: "samury-collections",
    storageBucket: "samury-collections.firebasestorage.app",
    messagingSenderId: "438495291004",
    appId: "1:438495291004:web:03218fd11ffd9b10eb4bf9",
    measurementId: "G-6NHZDEL2KE"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
  const storage = getStorage(app);

  const loginDiv = document.getElementById("loginDiv");
  const adminDiv = document.getElementById("adminDiv");
  const loginBtn = document.getElementById("loginBtn");
  const productsContainer = document.getElementById("productsContainer");

  // --- Login ---
  loginBtn.addEventListener("click", async () => {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    try {
      await signInWithEmailAndPassword(auth, email, password);
    } catch(e) {
      alert("Login failed: " + e.message);
    }
  });

  // --- Auth state ---
  onAuthStateChanged(auth, user => {
    if(user){
      loginDiv.style.display = "none";
      adminDiv.style.display = "block";
      loadProducts();
    } else {
      loginDiv.style.display = "block";
      adminDiv.style.display = "none";
    }
  });

  // --- Add Product ---
  document.getElementById("productForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const name = document.getElementById("name").value;
    const price = parseFloat(document.getElementById("price").value);
    const description = document.getElementById("description").value;
    const category = document.getElementById("category").value;
    const imageFile = document.getElementById("image").files[0];

    // Upload image to Firebase Storage
    const imageRef = ref(storage, `products/${Date.now()}_${imageFile.name}`);
    await uploadBytes(imageRef, imageFile);
    const imageUrl = await getDownloadURL(imageRef);

    // Add product to Firestore
    await addDoc(collection(db, "products"), {
      name, price, description, category, imageUrl, isPublished: true, createdAt: serverTimestamp()
    });

    e.target.reset();
    loadProducts();
  });

  // --- Load Products ---
  async function loadProducts() {
    productsContainer.innerHTML = "";
    const snapshot = await getDocs(collection(db, "products"));
    snapshot.forEach(docSnap => {
      const product = docSnap.data();
      const id = docSnap.id;
      const card = document.createElement("div");
      card.classList.add("product-card");
      card.innerHTML = `
        <img src="${product.imageUrl}" alt="${product.name}">
        <h3>${product.name}</h3>
        <p>Ksh ${product.price}</p>
        <p>${product.description}</p>
        <p><strong>Category:</strong> ${product.category}</p>
        <div class="btn-group">
          <button onclick="deleteProduct('${id}')">Delete</button>
          <button onclick="togglePublish('${id}', ${product.isPublished})">
            ${product.isPublished ? "Hide" : "Publish"}
          </button>
        </div>
      `;
      productsContainer.appendChild(card);
    });
  }

  // --- Delete Product ---
  window.deleteProduct = async (id) => {
    if(confirm("Delete this product?")) {
      await deleteDoc(doc(db, "products", id));
      loadProducts();
    }
  }

  // --- Toggle Publish ---
  window.togglePublish = async (id, current) => {
    await updateDoc(doc(db, "products", id), { isPublished: !current });
    loadProducts();
  }

</script>
</body>
</html>
